<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MobileAppProject.Views.RecipeListPage"
             x:Name="PageRoot"
             Title="Recipes"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource PrimaryDark}}">

    <ScrollView>
        <VerticalStackLayout Padding="15" Spacing="12">

            <!-- Title and Toggle Button Row -->
            <Grid>
                <Image Source="header.png"
                   Aspect="AspectFill"
                   HeightRequest="120"/>
                <Grid ColumnDefinitions="*,Auto" Padding="0,0,0,8">
                    <!-- Title -->
                    <Label Text="Fall Recipes"
                       FontAttributes="Bold"
                       FontSize="28"
                       VerticalOptions="Center"
                       HorizontalOptions="Start"
                       Margin="15,0,0,0"
                       TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource White}}">
                        <Label.Shadow>
                            <Shadow Brush="Black" Offset="1,1" Radius="2"/>
                        </Label.Shadow>
                    </Label>

                    <!-- Buttons -->
                    <StackLayout Grid.Column="1" Orientation="Vertical" Spacing="8" VerticalOptions="Center">
                        <Button Text="View Favourites"
                    Clicked="OnViewFavouritesClicked"/>
                        <Button Text="Toggle Theme"
                    Clicked="OnToggleThemeClicked"/>
                    </StackLayout>
                </Grid>
            </Grid>

            <!-- Search bar -->
            <Grid ColumnDefinitions="*,Auto" Margin="0,10,0,0">
                <Entry Placeholder="Search by ingredient or dish..."
                       Text="{Binding SearchQuery}" />
                <Button Text="Search"
                        Command="{Binding SearchCommand}"
                        Grid.Column="1"
                        Margin="5,0,0,0"/>
            </Grid>

            <!-- Recipe List -->
            <CollectionView ItemsSource="{Binding Recipes}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems Mode="Reveal">
                                    <SwipeItem
                            Text="Favourite"
                            BackgroundColor="Orange"
                            Command="{Binding BindingContext.ToggleFavouriteCommand, Source={x:Reference PageRoot}}"
                            CommandParameter="{Binding .}" />
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <!-- Recipe card -->
                            <Border Padding="8" BackgroundColor="{AppThemeBinding Light={StaticResource SoftYellow}, Dark={StaticResource AccentOrange}}">
                                <Grid ColumnDefinitions="100,*">
                                    <Image Source="{Binding ImageFile}" Aspect="AspectFill" HeightRequest="80" WidthRequest="100"/>
                                    <StackLayout Grid.Column="1" Padding="8,0" VerticalOptions="Center">
                                        <Label Text="{Binding Title}" FontAttributes="Bold" FontSize="16"/>
                                        <Label Text="{Binding ShortDescription}" LineBreakMode="TailTruncation" MaxLines="2"/>
                                    </StackLayout>
                                </Grid>

                                <!-- Move TapGestureRecognizer here, only if you want tapping card to open recipe -->
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer
                            Command="{Binding BindingContext.SelectRecipeCommand, Source={x:Reference PageRoot}}"
                            CommandParameter="{Binding .}" />
                                </Border.GestureRecognizers>
                            </Border>

                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>


        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
